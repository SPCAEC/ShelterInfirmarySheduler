<script>
// Predefine namespace immediately
window.SPCA = window.SPCA || {};

document.addEventListener('DOMContentLoaded', () => {
  const $  = sel => document.querySelector(sel);
  const $$ = sel => [...document.querySelectorAll(sel)];

  const header = $('#appHeader');
  const sectionTitle = $('#sectionTitle');
  const backBtn = $('#backBtn');
  const mainMenu = $('#mainMenu');
  const views = $$('.sub-view');

  const CLIENT_CACHE_KEY = 'gap_client_cache_v1';
  const setClientCache = (obj) => sessionStorage.setItem(CLIENT_CACHE_KEY, JSON.stringify(obj || {}));
  const getClientCache = () => {
    try { return JSON.parse(sessionStorage.getItem(CLIENT_CACHE_KEY) || '{}'); }
    catch { return {}; }
  };
  const clearClientCache = () => sessionStorage.removeItem(CLIENT_CACHE_KEY);

  // Fill in namespace
  Object.assign(window.SPCA, {
    $, $$, header, sectionTitle, backBtn, mainMenu, views,
    setClientCache, getClientCache, clearClientCache
  });
});
</script>