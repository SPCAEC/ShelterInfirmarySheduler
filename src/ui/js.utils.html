<script>
/**
 * SPCA Shelter-Side Clinic Scheduling — Shared Utilities
 * ------------------------------------------------------
 *  Provides helper functions, cached state, and DOM references
 *  for consistent access across modules (navigation, who-are-you,
 *  schedule flow, etc.)
 */

window.SPCA = window.SPCA || {};

document.addEventListener('DOMContentLoaded', () => {
  const $  = sel => document.querySelector(sel);
  const $$ = sel => [...document.querySelectorAll(sel)];

  const header = $('#appHeader');
  const sectionTitle = $('#sectionTitle');
  const backBtn = $('#backBtn');
  const mainMenu = $('#mainMenu');
  const views = $$('.sub-view');

  // ─── Client Cache (per-session) ───────────────────────────
  const CLIENT_CACHE_KEY = 'shelter_client_cache_v1';

  function safeSet(key, value) {
    try { sessionStorage.setItem(key, value); } catch { /* ignore */ }
  }
  function safeGet(key) {
    try { return sessionStorage.getItem(key); } catch { return null; }
  }
  function safeRemove(key) {
    try { sessionStorage.removeItem(key); } catch { /* ignore */ }
  }

  const setClientCache = (obj) => safeSet(CLIENT_CACHE_KEY, JSON.stringify(obj || {}));
  const getClientCache = () => {
    try { return JSON.parse(safeGet(CLIENT_CACHE_KEY) || '{}'); }
    catch { return {}; }
  };
  const clearClientCache = () => safeRemove(CLIENT_CACHE_KEY);

  // ─── Expose to Global Namespace ───────────────────────────
  Object.assign(window.SPCA, {
    $, $$, header, sectionTitle, backBtn, mainMenu, views,
    setClientCache, getClientCache, clearClientCache
  });
});
</script>