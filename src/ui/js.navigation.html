<script>
document.addEventListener('DOMContentLoaded', () => {
  const { $$, backBtn, header, sectionTitle, mainMenu, views, clearClientCache } = window.SPCA;

  // â”€â”€â”€ Tile navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  $$('.tile').forEach(btn => {
    btn.addEventListener('click', () => openView(btn.dataset.view));
  });

  // â”€â”€â”€ Back button: return to main menu â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  backBtn.addEventListener('click', () => {
    clearClientCache();
    header.classList.add('hidden');
    sectionTitle.textContent = '';
    views.forEach(v => v.classList.add('hidden'));
    mainMenu.classList.remove('hidden');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  // â”€â”€â”€ View switching logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openView(view) {
    mainMenu.classList.add('hidden');
    header.classList.remove('hidden');
    sectionTitle.textContent = viewTitle(view);
    views.forEach(v => v.classList.add('hidden'));

    const target = document.querySelector(`#view-${view}`);
    target.classList.remove('hidden');

    if (view === 'schedule') {
      // ðŸ”¹ Correct: use the actual function exported by who-are-you.js
      if (typeof showWhoAreYouScreen === 'function') {
        showWhoAreYouScreen(target, () => {
          // callback after scheduler selection
          if (typeof renderScheduleFlow === 'function') renderScheduleFlow(target);
        });
      } else if (typeof renderScheduleFlow === 'function') {
        renderScheduleFlow(target); // fallback
      }
    }
  }

  function viewTitle(view) {
    return {
      schedule: 'Schedule New Appointment',
      modify:   'Modify Existing Appointment',
      cancel:   'Cancel Appointment',
      outcome:  'Log Appointment Outcome'
    }[view] || '';
  }

  // Expose globally so other modules (like who-are-you) can hook in
  window.openView = openView;
});
</script>