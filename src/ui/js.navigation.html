<script>
document.addEventListener('DOMContentLoaded', () => {
  const { $$, backBtn, header, sectionTitle, mainMenu, views, clearClientCache } = window.SPCA;

  /* ==========================================================
   *  Navigation Logic — Shelter-Side Clinic Scheduling
   * ==========================================================
   *  • Handles tile clicks from main menu
   *  • Switches between main menu and the active scheduling view
   *  • Integrates the "Who Are You?" step before scheduling
   *  • Hides inactive sections and resets header on back
   * ========================================================== */

  // ─── Tile Navigation ───────────────────────────
  $$('.tile').forEach(btn => {
    btn.addEventListener('click', () => openView(btn.dataset.view));
  });

  // ─── Back Button → Return to Main Menu ─────────
  backBtn.addEventListener('click', () => {
    clearClientCache();
    header.classList.add('hidden');
    sectionTitle.textContent = '';
    views.forEach(v => v.classList.add('hidden'));
    mainMenu.classList.remove('hidden');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  // ─── View Switching ────────────────────────────
  function openView(view) {
    mainMenu.classList.add('hidden');
    header.classList.remove('hidden');
    sectionTitle.textContent = viewTitle(view);
    views.forEach(v => v.classList.add('hidden'));

    const target = document.querySelector(`#view-${view}`);
    if (!target) return;
    target.classList.remove('hidden');

    // Shelter-Side flow only supports scheduling
    if (view === 'schedule') {
      if (typeof showWhoAreYouScreen === 'function') {
        showWhoAreYouScreen(target, () => {
          if (typeof renderScheduleFlow === 'function') renderScheduleFlow(target);
        });
      } else if (typeof renderScheduleFlow === 'function') {
        renderScheduleFlow(target);
      }
    } else {
      // Placeholder for future features
      target.innerHTML = `<p style="text-align:center; margin-top:2rem; opacity:.6;">This feature is coming soon.</p>`;
    }
  }

  function viewTitle(view) {
    return {
      schedule: 'Shelter-Side Appointment Scheduling'
    }[view] || '';
  }

  // Expose globally
  window.openView = openView;
});
</script>